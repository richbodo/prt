[pytest]
# Pytest configuration for PRT

# Test markers for organizing test types
markers =
    unit: Fast unit tests (< 1 second) - test deterministic components without external dependencies
    integration: Integration tests with mocks (< 5 seconds) - test workflows with MockLLMService
    e2e: End-to-end tests (< 10 seconds) - test complete user workflows
    contract: LLM contract tests with promptfoo (1-5 minutes) - validate real LLM behavior
    slow: Slow end-to-end tests (5-10 minutes) - manual/nightly full system tests
    performance: Performance benchmarking tests - measure query speed and resource usage
    requires_llm: Tests that require real LLM connection (Ollama running)
    requires_db: Tests that require database connection
    ci_fast: Fast CI tests (unit + integration) - suitable for PR validation (< 2 minutes)
    ci_comprehensive: Comprehensive CI tests - includes all test types for nightly runs
    skipif_no_ollama: Skip test if Ollama is not available - use for LLM contract tests

# Test discovery patterns
python_files = test_*.py
python_classes = Test*
python_functions = test_*

# Directories to ignore during test collection
norecursedirs = .git .tox dist build *.egg prt_env EXTERNAL_DOCS docs

# Output options and default settings
addopts =
    --strict-markers
    --verbose
    --tb=short
    -ra
    --timeout=120
    --strict-config
    --disable-warnings

# Asyncio mode for async tests
asyncio_mode = auto

# Test timeout settings by category
# Override with --timeout for specific runs
[pytest.timeouts]
unit = 30
integration = 120
e2e = 300
performance = 600
contract = 600

# Coverage options (when using --cov flag)
[coverage:run]
source = prt_src
omit =
    */tests/*
    */conftest.py
    */__pycache__/*

[coverage:report]
precision = 2
show_missing = True
skip_covered = False

# Exclude lines from coverage
exclude_lines =
    pragma: no cover
    def __repr__
    raise AssertionError
    raise NotImplementedError
    if __name__ == .__main__.:
    if TYPE_CHECKING:
    @abstractmethod
